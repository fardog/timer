function leadingZero(e){return e<10?"0"+e.toString():e.toString()}function setTimerDisplay(e,t){var n,r="";if(t<0&&!e.hasClass("done")){e.addClass("done"),e.data("tf").sound.play(),n="Done!";var i=e.find(".panel");i.animate({backgroundColor:"#31ff3f"},1e3);var s=e.find("a.cancel");s.text("Clear"),s.removeClass("cancel"),s.addClass("large success expand"),e.children("div").append($("<a>",{text:"Silence",href:"#","class":"large alert button expand"}).click(function(t){t.preventDefault(),e.data("tf").silence(e),$(this).text("Silenced"),$(this).addClass("disabled")}))}t<0&&(t=0-t,r="+");var o=Math.floor(t/60),u=Math.floor(o/60);n=leadingZero(o-u*60)+":"+leadingZero(t%60),u>0?(n=u.toString()+" hr. <small>"+n+"</small>",e.find("h2").addClass("hours")):e.find("h2").removeClass("hours"),e.find("h2").empty().append(r+n)}function addTimerToDOM(e){var t=$("#timers"),n=t.children(":last"),r=$("#intro");r.length&&r.remove();if(n.length){n.children().length*COLUMN_VALUE>=COLUMN_TOTAL?t.append($("<div>",{"class":"row"}).append(e)):n.append(e);return}t.append($("<div>",{"class":"row"}).append(e))}function reorganizeTimers(){var e=$("#timers");e.children().each(function(){if($(this).children().length*COLUMN_VALUE<COLUMN_TOTAL){var e=$(this).next();if(e.children().length>0){var t=e.children(":first");t.detach(),$(this).append(t)}e.children().length<1&&e.remove()}})}function setError(e,t){e.parent().addClass("error"),e.parent().children("small").remove(),e.parent().append($("<small>",{text:t}))}$(document).foundation();var COLUMN_VALUE=4,COLUMN_TOTAL=12;$(document).ready(function(){$("#time").focus();var e=new Audio;e.src=Modernizr.audio.ogg?"assets/sounds/78562__joedeshon__alarm-clock-ringing-01.ogg":Modernizr.audio.mp3?"assets/sounds/78562__joedeshon__alarm-clock-ringing-01.mp3":"assets/sounds/78562__joedeshon__alarm-clock-ringing-01.m4a",e.load(),$("#add-timer").submit(function(t){t.preventDefault();var n=$(this).find("input:text"),r=n.val();try{var i=juration.parse(r)}catch(t){setError(n,"Sorry, we didn't understand that. Try again?");return}if(i>359999){setError(n,"That's a long time! Try a smaller span.");return}n.parent().hasClass("error")&&(n.parent().removeClass("error"),n.parent().children("small").remove());var s=$("<div>",{"class":"timer large-"+COLUMN_VALUE+" columns"}).append($("<div>",{"class":"panel"}).append($("<h2>",{text:i})));s.data("tf",{method:function(e){var t=new Date,n=e.data("tf").finishTime.valueOf()-t.valueOf();setTimerDisplay(e,Math.ceil(n/1e3)),setTimeout(function(){e.data("tf").method(e)})},finishTime:new Date(Date.now()+i*1e3),canceled:!1,cancel:function(e){var t=e.parent();e.data("tf").sound.pause(),e.data("tf").canceled=!0,e.fadeOut(400,function(){e.remove(),t.children().length<1&&t.remove(),reorganizeTimers()})},silenced:!1,silence:function(e){e.data("tf").sound.pause(),e.data("tf").silenced=!0},sound:e.cloneNode(!0)}),setTimerDisplay(s,i),setTimeout(function(){s.data("tf").method(s)},1e3),s.children("div").append($("<a>",{text:"Cancel",href:"#","class":"large cancel button expand"}).click(function(e){e.preventDefault(),s.data("tf").cancel(s)})),addTimerToDOM(s)})});
